<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞ API –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ (–∑–∞–≥–ª—É—à–∫–∞)
        async function analyzeCode() {
            const code = document.getElementById('module_code').value;
            const output = document.getElementById('commands_output');
            output.textContent = '–ê–Ω–∞–ª–∏–∑...';

            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π fetch –∫ /api/v1/analyze_code
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É, —Ç–∞–∫ –∫–∞–∫ Flask-API —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞–ø—Ä—è–º—É—é
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                await new Promise(r => setTimeout(r, 1500)); 
                const mockResponse = {
                    success: true,
                    commands: ".search - –ò—â–µ—Ç –º–æ–¥—É–ª–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.\n.get_info - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥—É–ª–µ.\n"
                };

                if (mockResponse.success) {
                    output.textContent = mockResponse.commands;
                    document.getElementById('commands_field').value = mockResponse.commands;
                } else {
                    output.textContent = `–û—à–∏–±–∫–∞: ${mockResponse.commands}`;
                }

            } catch (error) {
                output.textContent = `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: ${error.message}`;
            }
        }
    </script>
</head>
<body>
    <header>
        <nav>
            <a href="{{ url_for('modules_list') }}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            {% if logged_in %}
                <a href="{{ url_for('account_page') }}">üë§ –ê–∫–∫–∞—É–Ω—Ç</a>
                {% if is_admin %}
                    <a href="{{ url_for('moderation_panel') }}">üîë –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª—å</a>
                {% endif %}
                <a href="{{ url_for('login_route') }}" style="background-color: #e74c3c;">üö™ –í—ã—Ö–æ–¥ (–õ–æ–∫–∞–ª—å–Ω—ã–π)</a>
            {% endif %}
        </nav>
    </header>
    
    <div class="container">
        <h1>üìù –ü–æ–¥–∞—á–∞ –ù–æ–≤–æ–≥–æ –ú–æ–¥—É–ª—è</h1>
        
        <form id="submit_form" method="POST" action="{{ url_for('submit_module_api') }}">
            
            <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –ú–æ–¥—É–ª—è:</label>
            <input type="text" id="name" name="name" required>
            
            <label for="author">–ê–≤—Ç–æ—Ä (–í–∞—à Telegram –Ω–∏–∫):</label>
            <input type="text" id="author" name="author" value="{{ telegram_username }}" required>
            
            <label for="description">–ö—Ä–∞—Ç–∫–æ–µ –û–ø–∏—Å–∞–Ω–∏–µ (–¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤):</label>
            <textarea id="description" name="description" rows="3" maxlength="200" required></textarea>
            
            <label for="module_code">–ö–æ–¥ –ú–æ–¥—É–ª—è (Python):</label>
            <textarea id="module_code" name="module_code" rows="15" required></textarea>
            
            <button type="button" onclick="analyzeCode()" style="background-color: #f39c12;">üîç –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ö–æ–º–∞–Ω–¥—ã</button>
            
            <label>–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã:</label>
            <pre id="commands_output" style="background:#ecf0f1; padding: 10px; border-radius: 6px;"></pre>
            <input type="hidden" id="commands_field" name="commands">
            
            <button type="submit" onclick="this.textContent='–û—Ç–ø—Ä–∞–≤–∫–∞...'">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ú–æ–¥–µ—Ä–∞—Ü–∏—é</button>
        </form>
    </div>
</body>
</html>
