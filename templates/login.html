<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // --- –§–£–ù–ö–¶–ò–ò-–ó–ê–ì–õ–£–®–ö–ò –î–õ–Ø –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ---
        function generateMockToken() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç Firebase SDK –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google.
            // –ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤ –∫–∞—á–µ—Å—Ç–≤–µ "—Ç–æ–∫–µ–Ω–∞".
            return 'mock_firebase_id_token_' + new Date().getTime();
        }

        async function handleGoogleSignIn() {
            const loginButton = document.getElementById('google-login-button');
            const errorMessage = document.getElementById('error-message');
            loginButton.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
            errorMessage.style.display = 'none';

            // 1. –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (–≤ —Ä–µ–∞–ª–µ —ç—Ç–æ Firebase SDK)
            const idToken = generateMockToken();

            // 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Å—Å–∏–∏
            try {
                const response = await fetch("{{ url_for('auth_api') }}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ idToken: idToken })
                });

                const result = await response.json();

                if (result.success) {
                    // –£—Å–ø–µ—Ö: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–∫–∫–∞—É–Ω—Ç–∞
                    window.location.href = result.redirect;
                } else {
                    // –û—à–∏–±–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    errorMessage.textContent = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + result.message;
                    errorMessage.style.display = 'block';
                    loginButton.textContent = 'Google Sign-In';
                }

            } catch (error) {
                errorMessage.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞: ' + error.message;
                errorMessage.style.display = 'block';
                loginButton.textContent = 'Google Sign-In';
            }
        }
    </script>
</head>
<body>
    <header>
        <nav>
            <a href="{{ url_for('modules_list') }}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <!-- –í—Ö–æ–¥/–í—ã—Ö–æ–¥ –∑–¥–µ—Å—å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Å–∞–º–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ -->
        </nav>
    </header>
    
    <div class="container">
        <h1>‚û°Ô∏è {{ title }}</h1>
        
        <p>–î–ª—è –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ. (–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç Firebase Google Sign-In)</p>
        
        <p id="error-message" class="error" style="display:none;"></p>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç JS-—Ñ—É–Ω–∫—Ü–∏—é handleGoogleSignIn -->
        <button 
            type="button" 
            id="google-login-button"
            onclick="handleGoogleSignIn()" 
            class="suggest-link" 
            style="background-color: #e74c3c; width: 100%;"
        >
            Google Sign-In
        </button>

        <p style="margin-top: 30px;">
            <small>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Flask/Firebase Admin SDK. –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è *–∑–∞–≥–ª—É—à–∫–∞ —Ç–æ–∫–µ–Ω–∞*.</small>
        </p>
    </div>
</body>
</html>
